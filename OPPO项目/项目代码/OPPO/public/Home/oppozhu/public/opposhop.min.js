function isMobile(){return/(ipad|iphone|ipod|android)/.test(navigator.userAgent.toLowerCase())}function feedback(){document.querySelector(".fly-feedback")&&(document.querySelector(".fly-feedback").style.display="block");var t=!1;$("#overlay-feedback").size()||$("body").append($('<div id="overlay-feedback" />'));$("#overlay-feedback");$("#feedback-button").on("touchstart",function(e){t=!t,$(this).parent().find(".feedback-tooltip")[t?"addClass":"removeClass"]("feedback-active"),$("#overlay-feedback").css("display",t?"block":"none"),$("html")[t?"addClass":"removeClass"]("feedback-opened"),e.preventDefault()}),$("#overlay-feedback").on("touchstart",function(e){$(".fly-feedback").find(".feedback-tooltip")[t?"removeClass":"addClass"]("feedback-active"),$("#overlay-feedback").css("display",t?"none":"block"),$("html")[t?"removeClass":"addClass"]("feedback-opened"),t=!1,e.preventDefault()})}!function(t){t(function(){var e=t("[data-trigger]");e.each(function(){var e=t(this);e.click(function(){var i=e.data("trigger");t("#"+i).click()})}),t(".lazyload").length>0&&t(".lazyload").lazyload({effect:"fadeIn",data_attribute:"src",placeholder:"/assets/images/blank.gif"})})}(jQuery);var OPPO={utils:{},conf:{},controller:{},lang:{must_be_integer:"请输入数字"}};OPPO.controller.CartsController=function(){var t,e=function(t,e){if(t>=0&&e){var i={quantity:t,id:e};$.post("/cart/update",i).done(function(i){$(".error_msg_note").text("");var n=parseInt(i.status,10);if(n>0){var r=$(".cart-product-"+e),s=parseInt(i.data.goods_number);0===t?r.remove():(r.find(".cart-gift-count").html("×"+t),r.find("input.number").val(t),$(".cart-product-quantity-"+e).data("quantity",t)),0===s?($("#shipping_btn").remove(),$(".n-item-cart").html(0),$(".purchase-list").html('<center><h2>购物车空空的，去<a href="/" style="color:#1f8657;">逛逛</a>吧</h2></center>')):$(".n-item-cart").text(s),a()}else $(".error_msg_note").text(i.message)}).fail(function(t){$(".error_msg_note").text("系统异常。")})}},i=function(t,e){if(t>=0&&e){var i={id:e};$.post("/cart/remove",i).done(function(i){$(".error_msg_note").text("");var n=parseInt(i.status,10);if(n>0){var r=$(".cart-product-"+e),s=parseInt(i.data.goods_number);0===t&&r.remove(),0===s?($("#shipping_btn").remove(),$(".n-item-cart").html(0),$(".purchase-list").html('<center><h2>购物车空空的，去<a href="/" style="color:#1f8657;">逛逛</a>吧</h2></center>')):$(".n-item-cart").text(s),a()}else $(".error_msg_note").text(i.message)}).fail(function(t){$(".error_msg_note").text("系统异常。")})}},a=function(){var t=0,e=0;$(".check-box-item").each(function(){if($(this).hasClass("is-checked")){var i=$(this).data("id");$(".cart-product-quantity-"+i).each(function(){t+=parseInt($(this).data("quantity")),e+=parseFloat($(this).data("price")*$(this).data("quantity"))})}}),$(".total-amount").text(t),$(".total-fee").text("￥"+parseFloat(e).toFixed(2))},n=function(){$(".check-box-all").on("click",function(t){$(this).hasClass("is-checked")?$(".check-box-label").removeClass("is-checked"):$(".check-box-label").addClass("is-checked"),a()}),$(".check-box-item").on("click",function(t){var e=$(this);if(e.hasClass("is-checked"))e.removeClass("is-checked"),$(".check-box-all").removeClass("is-checked");else{var i=!0;e.addClass("is-checked"),$(".check-box-item").each(function(){$(this).hasClass("is-checked")||(i=!1)}),i&&$(".check-box-all").addClass("is-checked")}a()})},r=$(".purchase-list"),s=".minus",o=".plus",c=".cart-product-delete",l=$("#dialog-confirm"),d=$("#dialog-error-msg"),u=$("#dialog-error-msg .dialog-title-common"),m=$("#dialog-error-msg .button-one-whole"),p=$("#dialog-confirm .button-one"),f=$("#dialog-confirm .button-two"),h=$(".cart-gift-sku li"),v=$("#shipping_btn"),b=$("#shipping_btn_m");return{index:function(){return n(),h.on("click",function(){var t=$(this);if(t.hasClass("active"))return!1;var e=t.data("goods-id"),i=t.data("spu-id"),a=t.data("gift-id"),n=t.data("gift-name"),r=t.data("gift-img"),s=t.data("cart-id");if($(".cart-product-"+s).hasClass("cart-expired"))return!1;if(t.hasClass("cart-expired"))return u.html("该赠品已失效不能选择。").css({color:"#f00"}),d.removeClass("hidden"),!1;var o=OPPO.conf.BASE_URL+"/cart/update/attribute/"+t.data("cart-id"),c={goods_id:e,attr_spu:i,attr_sku:a,type:1};$.post(o,c,function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);i>0?(t.addClass("active").siblings("li").removeClass("active"),t.parent("ul").prev(".heading").find("a").attr("href",OPPO.conf.BASE_URL+"/products/"+a).html(n),t.parent("ul").parent().parent().parent().find(".cart-gift-image").attr("href",OPPO.conf.BASE_URL+"/products/"+a).find("img").attr("src",r)):$(".error_msg_note").text(e.message)})}),r.off("click",s).on("click",s,function(){var t=$(this).siblings("input").val(),i=$(this).attr("data-id");return!$(".cart-product-"+i).hasClass("cart-expired")&&(!(t<2)&&(t--,void e(t,i)))}),r.off("click",o).on("click",o,function(){var t=$(this).siblings("input").val(),i=$(this).attr("data-id");return!$(".cart-product-"+i).hasClass("cart-expired")&&(t>=10?($(".error_msg_note").text("商品单次购买上限为10，请重新选择购买数量"),!1):(t++,void e(t,i)))}),r.off("click",c).on("click",c,function(){l.removeClass("hidden"),l.find("#product-id").remove(),l.append('<input type="hidden" id="product-id" data-id="'+$(this).attr("data-id")+'"/>')}),p.on("click",function(t){t.preventDefault();var e=l.find("#product-id").data("id"),a=0;e&&i(a,e),l.addClass("hidden")}),f.on("click",function(t){l.addClass("hidden")}),m.on("click",function(t){d.addClass("hidden")}),v.on("click",function(){OPPO.submit.isSubmit||vm.goToShipping("/trade")}),b.on("click",function(){OPPO.submit.isSubmit||vm.goToShipping("/trade")}),{goToShipping:function(e){var i=[],a=$(".check-box-item");return a.each(function(t,e){$(this).hasClass("is-checked")&&i.push($(this).data("id"))}),i.length<=0?(u.html("购物车无可购买商品,请重新添加商品至购物车。").css({color:"#f00"}),d.removeClass("hidden"),!1):(OPPO.submit.isSubmit=!0,OPPO.submit.change(v,"提交中"),$(".error_msg_note").text(""),u.html(""),void(t=$.ajax({url:OPPO.conf.BASE_URL+"/cart/count",type:"POST",data:{id:i},dataType:"json",timeout:1e4}).done(function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);if(i>0){parseInt(t.data);window.location.href=e}else u.html(t.message).css({color:"#f00"}),d.removeClass("hidden"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(v,"结算")}).fail(function(){u.html("系统异常，请稍后再试。").css({color:"#f00"}),d.removeClass("hidden"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(v,"结算")}).always(function(e,i){"timeout"===i&&t.abort()})))}}}}},$(function(){$.each($(".lt-ie9 input[type=text],.lt-ie9 textarea"),function(t,e){var i=$(e).attr("placeholder"),a=$(e).val();return"undefined"!=typeof i&&""!=i&&""==a&&($(e).val(i),$(e).on("focus",function(){var t=$(this).val();t==i&&$(this).val("")}),void $(e).on("blur",function(){var t=$(this).val();""==t&&$(this).val(i)}))})}),OPPO.controller.CompareController=function(){var t=function(){var t=$("#compare-box");$("body").on("click","#compare-box .compare-box-mobile",function(){if($(this).hasClass("is-disabled"))return!1;$(this).hasClass("is-selected")?$(this).removeClass("is-selected"):$(this).addClass("is-selected");var e=t.find(".compare-box-mobile"),i=t.find(".is-selected"),a=t.find(".is-disabled"),n=$("#compare-btn button"),r=$("#compare-btn-tip"),s=i.length;return s>=4?e.not(".is-selected").addClass("is-disabled"):a.removeClass("is-disabled"),s>=1?(r.show().find("span").html(s),s>1?n.removeClass("is-disabled"):n.addClass("is-disabled")):r.hide().find("span").html(0),!1})},e=function(){$("body").on("click","#compare-btn button",function(){if($(this).hasClass("is-disabled"))return $(".compare-top-tip").css({color:"red"}),!1;var t=$("#compare-box").find(".is-selected"),e=OPPO.conf.BASE_URL+"/compare/details?id=";$.each(t,function(t,i){var a=$(i).find("input[name=spuId]").val();e+=0==t?a:","+a}),window.location.href=e})},i=function(){$("body").on("click",".compare-panel-title",function(){$(this).hasClass("open")?$(this).removeClass("open"):$(this).addClass("open");var t=$(this).parent().find(".compare-panel-content");t.hasClass("open")?t.removeClass("open"):t.addClass("open")})},a=function(){$("body").on("click",".btn-compare-different",function(){return $(".btn-compare-different").hasClass("open")?$("tr.compare-params.different").hasClass("notdifferent")?($("tr.compare-params.different").removeClass("notdifferent"),$(".btn-compare-different").html("取消高亮")):($("tr.compare-params.different").addClass("notdifferent"),$(".btn-compare-different").html("高亮不同项")):($(".btn-compare-different").addClass("open"),$(".btn-compare-different").html("取消高亮"),$.each($("tr.compare-params"),function(t,e){$.each($(e).find("td.compare-param"),function(t,i){var a="",n=!1;$.each($(i).find(".compare-panel-content span"),function(t,e){0==t?a=$(e).html():a!=$(e).html()&&(n=!0)}),n&&$(e).addClass("different")})})),!1}),$(".compare-box").append('<div class="compare-fixed"><div class="wrapper"><table class="compare-table"></table></div></div>'),$("table.compare-table").find("tr").eq(0).clone().appendTo(".compare-fixed .wrapper table").find(".btn-compare-different").addClass("button-light"),$("body").on("click",".compare-price a.button",function(){return!$(this).hasClass("active")&&($(this).parent().find("a.active").removeClass("active"),$(this).addClass("active"),$(this).parent().find("span").html("￥"+$(this).data("price")),!1)}),$(window).scroll(function(){var t=$(window).scrollTop(),e=$(".compare-group").eq(0).offset().top;t>e?$(".compare-fixed").slideDown(300):$(".compare-fixed").slideUp(300)})};return{index:function(){return t(),e(),{}},details:function(){return i(),a(),{}}}},$(function(){$(".footer-focus-icon").hover(function(){$(this).find(".wx-float").show()},function(){$(this).find(".wx-float").hide()}),$("body").on("click",".footer-focus-icon",function(){return!1}),$("body").on("mouseenter","#btn-qr",function(){$("#qr-code").show()}),$("body").on("mouseleave","#btn-qr",function(){$("#qr-code").hide()}),$("body").on("click",".footer-sitemap .js-toggle-sitemap",function(){return $(this).hasClass("active")?$(this).removeClass("active").parent().find("ul").hide():($(".footer-sitemap .js-toggle-sitemap").each(function(){$(this).hasClass("active")&&$(this).removeClass("active").parent().find("ul").hide()}),$(this).addClass("active").parent().find("ul").show()),!1}),isMobile()&&feedback()}),OPPO.controller.OrdersController=function(){var t=$("#dialog-confirm"),e=$("#dialog-confirm .button-one"),i=$("#dialog-confirm .button-two"),a=($(".order-history a"),function(e){t.removeClass("hidden"),t.find("#cancel-order-id").remove(),t.append('<input type="hidden" id="cancel-order-id" data-id="'+e+'"/>')}),n=function(){var e=t.find("#cancel-order-id").data("id");if(!e)return void alert("订单号不存在");var i=OPPO.conf.BASE_URL+"/orders/"+e;$.ajax({type:"DELETE",url:i}).success(function(t){if(!ajaxIsLogin(t))return!1;var e=parseInt(t.status,10);e>0?window.location.reload():alert(t.message)}).error(function(t){alert("系统异常。")})};e.on("click",function(e){e.preventDefault(),n(),t.addClass("hidden")}),i.on("click",function(e){t.addClass("hidden")});var r,s,o=function(){$("#waybill-view").on("click",function(){if($(this).hasClass("slideDown"))$(this).removeClass("slideDown"),$("#waybill-status").slideUp(300);else{$(this).addClass("slideDown");var t=$("#waybill-status").html();if(""!=t)$("#waybill-status").slideDown(300);else{$("#waybill-waiting").show();var e=$(this).attr("href");$.ajax({url:e,type:"get",dataType:"json",success:function(t){var e="";t.status<0?e=t.message:$.each(t.message,function(t,i){e+="<p><span>"+i.time+"</span> "+i.status+"</p>"}),$("#waybill-waiting").hide(),$("#waybill-status").html(e).slideDown(300).next(".kuaidi100").show()},error:function(){$("#waybill-waiting").hide(),$("#waybill-status").html("获取物流状态超时").slideDown(300)}})}}return!1})},c=function(){$(".js-tab-nav-for-qrpay").click(function(){if(!$(this).hasClass("hasClicked")){$(this).addClass("hasClicked");var t=$(".js-tab-iframe-for-qrpay").find("iframe");$(t).attr("src",$(t).data("src"))}})},l=$(".error_msg_note"),d=$("#pay_action"),u=function(t){s=$.ajax({url:"/orders/"+t+"/paystatus",type:"GET",dataType:"json",timeout:1e4}).done(function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);if(i>0){var a=$("#paymentJumpUrl").attr("href");window.location.href=a}else clearTimeout(r),r=setTimeout(function(){u(t)},3e3)}).fail(function(){clearTimeout(r),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(d,"立即支付")}).always(function(t,e){"timeout"===e&&(s.abort(),l.html("系统异常，请稍后再试。"))})},m=function(){var t=$("#weixin_qrcode");if(240==t.width())return!1;var e=$("#weixin_qrtext"),i=$("input[name=order_sn]").val(),a=t.data("src"),n=new Image;n.src=a,n.onload=function(){t.attr("src",a).width(240).height(240),u(i)},n.onerror=function(){e.html("微信扫码加载失败，请刷新重试"),t.attr("src","")},n.src=t.data("src")},p=function(){if($(".alipay-iframe").find("iframe").length>0){var t=$(".alipay-iframe").find("iframe");""==t.attr("src")&&t.attr("src",t.data("src"))}},f=function(){$(".list-platforms .radio-item").eq(0).show().find(".radio-extend").show().addClass("radio-selected");var t=$(".list-platforms .radio-item").eq(0).find("input.parent_radio").attr("code");"weixin_qrcode"==t?m():"alipay"==t&&p(),$("a.open-platforms").on("click",function(){$(".list-platforms .radio-item span.radio").removeClass("checked_radio"),$(".list-platforms .radio-item input:checked").attr("checked",!1),$(".radio-selected").removeClass("radio-selected").slideUp(300),$(".list-platforms .radio-item").fadeIn(300),$(this).parent().html("&nbsp;"),$(".opr-btn-pay").find(".button").addClass("button-disabled"),"undefined"!=typeof _optj&&_optj.push(["_trackEvent","store","link","order","open_platforms"])}),$("input.parent_radio").on("change",function(){clearTimeout(r),s&&s.abort(),$parent=$(this).parents(".radio-item");var t=$(this).attr("code"),e=$(this).val();!$parent.find(".radio-selected").length>0&&($(".radio-selected").length>0&&$(".radio-selected").removeClass("radio-selected").slideUp(300),$parent.find(".radio-extend").length>0&&$parent.find(".radio-extend").addClass("radio-selected").slideDown(300),$("input.bank_radio:checked").attr("checked",!1),$("input.bank_radio").parent().removeClass("checked_radio"),$(".input-big-radio input:checked").attr("checked",!1),$(".input-big-radio span").removeClass("checked_radio"),$(".fenqi_text").hide()),"alipay"==t||"tenpay"==t||"alipay_wap"==t||"weixin_js"==t?($(".opr-btn-pay").find(".button").removeClass("button-disabled"),"alipay"==t&&"alipay_hb"!=e&&p(),"alipay_hb"==e&&$(".opr-btn-pay").find(".button").addClass("button-disabled")):($(".opr-btn-pay").find(".button").addClass("button-disabled"),"weixin_qrcode"==t&&m())}),$(".input-big-radio input").on("change",function(){$(".fenqi_text").hide();var t=$(this).data("cnt"),e=$(this).data("param2"),i=$(this).data("param3"),a=(e/t).toFixed(2);$(".fenqi_text").find("span:eq(0)").html(t),$(".fenqi_text").find("span:eq(1)").html("￥"+a),$(".fenqi_text").find("span:eq(2)").html(i),$(".fenqi_text").fadeIn(300),$(".opr-btn-pay").find(".button").removeClass("button-disabled")}),$("input.bank_radio").on("change",function(){$(".opr-btn-pay").find(".button").removeClass("button-disabled");$(this).attr("bankcode")}),$("input.alipay_huabei_qishu").on("change",function(){$(".opr-btn-pay").find(".button").removeClass("button-disabled")}),$(".opr-order-detail a").on("click",function(){$(".opr-order-details").hasClass("open")?($(".opr-order-details").removeClass("open").slideUp(300),$(this).find(".icon").removeClass("icon-arrow-top-green").addClass("icon-arrow-up-green")):($(".opr-order-details").addClass("open").slideDown(300),$(this).find(".icon").removeClass("icon-arrow-up-green").addClass("icon-arrow-top-green"))});var e="{{$is_mobile}}";e&&$(".main-footer").hide()},h=!1,v=function(){var t=$(".coupon-code .alert-danger"),e=$("input[name=coupon-code]"),i=$("input[name=order_sn]"),a=$(".coupon-code-use");a.on("click",function(){var n=$.trim(e.val());if(!n||""===n)return t.html("请输入推荐码。"),!1;if(!OPPO.utils.checkCoupon(n))return t.html("推荐码格式不正确。"),!1;if(h)return!1;h=!0,OPPO.submit.change(a,"提交中"),t.html("");var r=OPPO.conf.BASE_URL+"/orders/addgifts",s=$.ajax({url:r,type:"POST",dataType:"json",data:{voucher_sn:n,serial:i.val()},timeout:1e4}).done(function(i){if(!ajaxIsLogin(i))return!1;var n=parseInt(i.status,10);n>0?(t.html("使用成功，该订单已成功赠送自拍杆一个，请尽快完成支付！"),e.attr("disabled",!0),a.html("立即使用"),a.hide(),clearTimeout(OPPO.submit.timer)):(t.html(i.message),h=!1,OPPO.submit.clearChange(a,"立即使用"))}).fail(function(e){t.html("使用失败"),h=!1,OPPO.submit.clearChange(a,"立即使用")}).always(function(e,i){"timeout"===i&&(s.abort(),t.html("系统异常，请稍后再试。"))})})};return{processing:function(){var t=1,e=3,i=t+Math.floor((e-t)*Math.random()),a=$("input[name=order_serial]").val();if(a){var n=function(t){var e=OPPO.conf.BASE_URL+"/orders/"+t+"/status";$.get(e).success(function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);if(i>0){var a=OPPO.conf.BASE_URL+"/orders/"+t+("online"==e.data?"/payments":"/confirmation");window.location.href=a}else n(t)}).error(function(){n(t)})};setTimeout(function(){n(a)},1e3*i)}},index:function(){return{cancel:function(t){a(t)}}},show:function(){return o(),{cancel:function(t){a(t)}}},payments:function(){function t(){var t=$("input[type=radio][name=payonline_category]:checked"),e=$("input[name=order_sn]"),i=$("input[name=payment_code]"),a=$("input[name=payment_bankcode]"),n=$("input[name=payment_method]"),o=$("input[name=payment_qr_pay]"),c=$("input[name=short_pay]"),m=$("input[name=payonline_bank]:checked"),p=$("input[name=payonline_installment]:checked"),f=$("input[name=huabei_qishu]"),h=$("input[name=alipay_huabei_qishu]:checked"),v=0!==t.length;if(l.html(""),!v)return l.html("请选择付款方式"),!1;if("wangyin"==t.val()&&!m.length>0)return l.html("请选择具体的银行网银支付"),!1;if("weixin_qrcode"==t.val()&&!m.length>0)return l.html("请选择使用微信扫码支付"),!1;if("installment"==t.val()&&!p.length>0)return l.html("请选择具体的分期支付方式"),!1;if("alipay_hb"==t.val()&&!h.length>0)return l.html("请选择花呗分期"),!1;if(OPPO.submit.isSubmit)return!1;if(e.val()){OPPO.submit.isSubmit=!0,OPPO.submit.change(d,"支付中");var b=t.attr("code"),g=t.val();if(f.val(""),"installment"===g){var P=p.attr("data-cnt"),O=$(".installment_str_"+P).val();$("#Request").val(O),$("#installment_payment_form").submit()}else if("wangyin"===g){var b=m.attr("code"),_=m.attr("bankcode"),y=m.attr("paymethod"),k=m.attr("kuaijiezhifu")?m.attr("kuaijiezhifu"):"0",x=m.attr("qr_pay")?m.attr("qr_pay"):"0";i.val(b),a.val(_),n.val(y),o.val(x),c.val(k),$("#payment_form").submit()}else if("alipay_hb"===g){var C=$("input[name=alipay_huabei_qishu]:checked").val();i.val(b),a.val("huabei"),f.val(C),$("#payment_form").submit()}else{var _=t.attr("bankcode"),y=t.attr("paymethod"),k=t.attr("kuaijiezhifu")?t.attr("kuaijiezhifu"):"0",x=t.attr("qr_pay")?t.attr("qr_pay"):"0";i.val(b),a.val(_),n.val(y),o.val(x),c.val(k),$("#payment_form").submit()}$("#dialog").removeClass("hidden"),clearTimeout(r),s&&s.abort(),r=setTimeout(function(){u(e.val())},3e3)}else l.html("操作异常，请重试")}c(),f(),v(),$(".dialog-close").click(function(){clearTimeout(r),$("#dialog").addClass("hidden"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(d,"立即支付"),s&&s.abort()}),$("#failed_to_pay").click(function(){clearTimeout(r),$("#dialog").addClass("hidden"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(d,"立即支付"),s&&s.abort()}),d.click(t);var e=$("a.alipay-redirect");e.click(t)}}},OPPO.controller.ProductsController=function(){var t=$(".buying-actions"),e=($("#button-buy"),$("#go-buy"),$("#buy-pack"));t.on("click","#button-buy",function(t){t.preventDefault(),OPPO.submit.isSubmit||vm.addToCart(!1,0,Yo.config.product_id)}),t.on("click","#go-buy",function(t){t.preventDefault(),OPPO.submit.isSubmit||vm.addToCart(!1,0,Yo.config.product_id,!0)}),e.on("click",function(t){t.preventDefault(),$("#amount-textbox").val(1),OPPO.submit.isSubmit||vm.addToCart(!1,0,Yo.config.product_id,!0,!0)});var i=function(t,i,a,n){OPPO.submit.isSubmit=!0,a?n?OPPO.submit.change(e,"提交中"):OPPO.submit.change($("#go-buy"),"提交中"):OPPO.submit.change($("#button-buy"),"提交中");var r=OPPO.conf.BASE_URL+"/cart/insert",s=$.ajax({url:r,type:"POST",timeout:5e3,data:t}).done(function(t){var i=parseInt(t.status,10);if(i>0){var r=t.data.url;window.location.href=r}else i===-100?(OPPO.submit.isSubmit=!1,a?n?OPPO.submit.clearChange(e,"购买套餐"):OPPO.submit.clearChange($("#go-buy"),"立即购买"):OPPO.submit.clearChange($("#button-buy"),"加入购物车"),oppo.win.open(t.data.url)):($(".buying-actions").next(".alert-danger").remove(),$(".buying-actions").after('<div class="row alert-danger">'+t.message+"</div>"),OPPO.submit.isSubmit=!1,a?n?OPPO.submit.clearChange(e,"购买套餐"):OPPO.submit.clearChange($("#go-buy"),"立即购买"):OPPO.submit.clearChange($("#button-buy"),"加入购物车"))}).fail(function(){OPPO.submit.isSubmit=!1,a?n?OPPO.submit.clearChange(e,"购买套餐"):OPPO.submit.clearChange($("#go-buy"),"立即购买"):OPPO.submit.clearChange($("#button-buy"),"加入购物车")}).always(function(t,e){"timeout"===e&&s.abort()})},a=$("#button-quick-buy");a.on("click",function(t){t.preventDefault(),OPPO.submit.isSubmit||w()});var n,r=function(){if(!is_insurance_allowed)return!1;if($('[data-type="service"]').length>0)return void l();var t=Yo.config.product_id,e=OPPO.conf.BASE_URL+"/products/service/insurance/"+t,i=$.ajax({url:e,type:"GET",dataType:"json",timeout:5e3}).done(function(t){if(t){var e=parseInt(t.status);e>0&&o(t.data)}}).fail(function(){}).always(function(t,e){"timeout"===e&&i.abort()})},s=function(t){switch(parseInt(t)){case 6:return"半";case 12:return"一"}},o=function(t){if(t){var t=JSON.parse(t);if(t.services){var e='<div class="one-quarter desk-one-fifth"><div class="y-label">服务</div></div><div class="gi three-quarters desk-four-fifths">';if((t.services.screen||t.services.accident)&&(e+='<div class="g pro-service-broke">'),t.services.screen)for(var i=t.services.screen,a=0;a<i.length;a++)i[a].promoted_fee<i[a].fee?(e+='<a class="gi pro-service-tab service-screen tab-promotion'+(0===parseInt(i[a].promoted_fee,10)?" active":"")+'" data-price="'+i[a].promoted_fee+'" data-origin="'+i[a].fee+'" data-ttl="'+i[a].ttl+'" data-title="'+s(i[a].ttl)+'">',e+=' <span class="service-flag-broke">碎</span>',e+=" <span>屏碎保"+s(i[a].ttl)+'年 <font class="promoted">￥'+i[a].promoted_fee+'&nbsp;&nbsp;</font><font class="normal">￥'+i[a].fee+"</font></span>",e+="</a>",0===parseInt(i[a].promoted_fee,10)&&$('input[name="service-screen"]').val(i[a].ttl)):(e+='<a class="gi pro-service-tab service-screen tab-normal" data-price="'+i[a].promoted_fee+'" data-origin="'+i[a].fee+'" data-ttl="'+i[a].ttl+'" data-title="'+s(i[a].ttl)+'">',e+=' <span class="service-flag-broke">碎</span>',e+=" <span>屏碎保"+s(i[a].ttl)+"年 ￥"+i[a].fee+"</span>",e+="</a>");if(t.services.accident)for(var n=t.services.accident,a=0;a<n.length;a++)n[a].promoted_fee<n[a].fee?(e+='<a class="gi pro-service-tab service-accident tab-promotion'+(0===parseInt(n[a].promoted_fee,10)?" active":"")+'" data-price="'+n[a].promoted_fee+'" data-origin="'+n[a].fee+'" data-ttl="'+n[a].ttl+'" data-title="'+s(n[a].ttl)+'">',e+=' <span class="service-flag-broke">意</span>',e+=" <span>意外保"+s(n[a].ttl)+'年 <font class="promoted">￥'+n[a].promoted_fee+'&nbsp;&nbsp;</font><font class="normal">￥'+n[a].fee+"</font></span>",e+="</a>",0===parseInt(n[a].promoted_fee,10)&&$('input[name="service-accident"]').val(n[a].ttl)):(e+='<a class="gi pro-service-tab service-accident tab-normal" data-price="'+n[a].promoted_fee+'" data-origin="'+n[a].fee+'" data-ttl="'+n[a].ttl+'" data-title="'+s(n[a].ttl)+'">',e+=' <span class="service-flag-broke">意</span>',e+=" <span>意外保"+s(n[a].ttl)+"年 ￥"+n[a].fee+"</span>",e+="</a>");if((t.services.screen||t.services.accident)&&(e+="</div>"),t.services.repair){var r=t.services.repair;e+='<div class="g pro-service-defer">';for(var a=0;a<r.length;a++)r[a].promoted_fee<r[a].fee?(e+='<a class="gi pro-service-tab service-repair tab-promotion'+(0===parseInt(r[a].promoted_fee,10)?" active":"")+'" data-price="'+r[a].promoted_fee+'" data-origin="'+r[a].fee+'" data-ttl="'+r[a].ttl+'" data-title="'+s(r[a].ttl)+'">',e+=' <span class="service-flag-defer">延</span>',e+=" <span>延保"+s(r[a].ttl)+'年 <font class="promoted">￥'+r[a].promoted_fee+'&nbsp;&nbsp;</font><font class="normal">￥'+r[a].fee+"</font></span>",e+="</a>",0===parseInt(r[a].promoted_fee,10)&&$('input[name="service-repair"]').val(r[a].ttl)):(e+='<a class="gi pro-service-tab service-repair tab-normal" data-price="'+r[a].promoted_fee+'" data-origin="'+r[a].fee+'" data-ttl="'+r[a].ttl+'" data-title="'+s(r[a].ttl)+'">',e+=' <span class="service-flag-defer">延</span>',e+=" <span>延保"+s(r[a].ttl)+"年 ￥"+r[a].fee+"</span>",e+="</a>");e+="</div>"}e+='<div class="pro-service-igree"><P>购买保险服务表示您已同意<a id="service-igree" class="terms">《OPPO保障服务条款》</a><a href="'+OPPO.conf.WWW_URL+'service/guarantee" target="_blank" class="color-primary">了解详情&gt;&gt;</a></P></div>',$(".pro-service").html(e),l(),$(".icon-tab-free-selected").parent().trigger("click"),c(),F.calculateMain(),F.calculatePrice()}}},c=function(){var t=$("#package-involve"),e=$("#product-services");if($actives=e.find(".pro-service-tab.active"),$actives.length>0){var i="";$actives.each(function(){var t=$(this);t.hasClass("service-repair")&&(i+="<em>"+t.attr("data-title")+"年延保</em>"),t.hasClass("service-screen")&&(i+="<em>屏碎保</em>"),t.hasClass("service-accident")&&(i+="<em>意外保</em>")}),t.html(i)}else t.html("&nbsp;")},l=function(){var t=$("input[name=service-repair]"),e=$("input[name=service-screen]"),i=$("input[name=service-accident]");$(".service-repair").on("click",function(){var e=$(this),i=(parseInt(e.attr("data-origin"),10),parseInt(e.attr("data-price"),10),$("#collect-prices"));parseInt(i.attr("data-price"),10),parseInt(i.attr("data-promoted"),10);e.hasClass("active")?(e.removeClass("active"),t.val(0)):(e.addClass("active").siblings("a").removeClass("active"),t.val(e.data("ttl"))),F.calculateMain(),F.calculatePrice(),c()}),$(".service-screen").on("click",function(){var t=$(this);t.hasClass("active")?(t.removeClass("active"),e.val(0)):(t.addClass("active").siblings("a").removeClass("active"),e.val(t.data("ttl")),i.val(0)),F.calculateMain(),F.calculatePrice(),c()}),$(".service-accident").on("click",function(){var t=$(this);t.hasClass("active")?(t.removeClass("active"),i.val(0)):(t.addClass("active").siblings("a").removeClass("active"),i.val(t.data("ttl")),e.val(0)),F.calculateMain(),F.calculatePrice(),c()}),$("#service-igree").on("click",function(){$("#modal-service").modal()})},d=$("#dialog-userinfo"),u=d.find("input[name=receiver]"),m=d.find("input[name=mobile]"),p=d.find("input[name=address-detail]"),f=d.find("select[name=province_id]"),h=d.find("select[name=city_id]"),v=d.find("select[name=district_id]"),b=d.find("select[name=town_id]"),g=d.find(".error-info"),P=function(){var t=$.trim(u.val()),e=$.trim(m.val()),i=$.trim(p.val()),a=f.find("option:selected").val(),r=h.find("option:selected").val(),s=v.find("option:selected").val(),o=b.find("option:selected").val();if(!t)return g.html("请输入收货人姓名。"),!1;if(OPPO.utils.checkSpec(t))return g.html("收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(t)>OPPO.utils.namelen)return g.html("收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(!e)return g.html("请输入手机号码。"),!1;if(!OPPO.utils.isMobile(e))return g.html("手机号码格式不正确。"),!1;if(!a||parseInt(a)===-1)return g.html("请选择省份。"),!1;if(!i)return g.html("请输入详细地址。"),!1;if(OPPO.utils.checkSpec(i))return g.html("详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(i)>OPPO.utils.addrlen)return g.html("详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;g.html(""),i=OPPO.utils.filtertxt(i,f.find("option:selected").text()),i=OPPO.utils.filtertxt(i,h.find("option:selected").text()),i=OPPO.utils.filtertxt(i,v.find("option:selected").text()),i=OPPO.utils.filtertxt(i,b.find("option:selected").text()),OPPO.submit.isSubmit=!0,OPPO.submit.change(O,"提交中");var c=$(".service-repair"),l=$(".service-screen"),d=$(".tab-selected"),P=0,_=0,y=0,k=$("#amount-textbox").val(),x=OPPO.conf.BASE_URL+"/orders/quickbuyV2";c&&c.each(function(){$(this).hasClass("active")&&(P=$(this).data("ttl"))}),l&&l.each(function(){$(this).hasClass("active")&&(_=$(this).data("ttl"))}),d&&d.each(function(){$(this).hasClass("active")&&(y=$(this).data("goods-attach"))});var C={id:Yo.config.product_id,quantity:k,services:{repair:P,screen:_},goods_attach:y,receiver:t,mobile:e,province_id:a,city_id:r,district_id:s,town_id:o,address_detail:i};$('[name="gift[]"]').length>0&&$('[name="gift[]"]').each(function(t){var e=$(this);C["gifts["+t+"]"]=e.val()}),n=$.ajax({url:x,type:"POST",dataType:"json",timeout:1e4,data:C}).done(function(t){if(!ajaxIsLogin(t))return!1;var e=parseInt(t.status,10);e>0?window.location.href=OPPO.conf.BASE_URL+"/"+t.data:(g.html(t.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(O,"提交"))}).fail(function(t){OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(O,"提交")}).always(function(t,e){"timeout"===e&&n.abort()})},O=$("#submit-userinfo");O.on("click",function(t){t.preventDefault(),OPPO.submit.isSubmit||P()}),$(".dialog-close").on("click",function(){y(),d.addClass("hidden"),n&&n.abort()});var _,y=function(){u.val(""),m.val(""),p.val(""),g.html(""),d.region({pid:-1,cid:-1,did:-1,tid:-1})},k=0,x=$("#dialog-userinfo .button-change");x.on("click",function(t){t.preventDefault(),g.html(""),k>=_.length-1?k=0:k++,C()});var C=function(){var t=_[k];d.region({pid:t.province_id,cid:t.city_id,did:t.district_id,tid:t.town_id}),u.val(t.receiver),m.val(t.mobile),p.val(t.address)},w=function(t){var t=t||!1;if(t)var e=$("#rush-buy");OPPO.submit.isSubmit=!0,OPPO.submit.change(t?e:a,"提交中");var i=OPPO.conf.BASE_URL+"/user/addresses/list?f=quickbuy",n=$.ajax({url:i,type:"get",dataType:"json",timeout:8e3}).done(function(i){if(!ajaxIsLogin(i))return!1;OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(t?e:a,"立即抢购");var n=parseInt(i.status,10);n>0&&i.data?(d.removeClass("hidden"),_=i.data,k=0,_.length>1&&x.show(),C()):(d.removeClass("hidden"),d.region({pid:-1,cid:-1,did:-1,tid:-1}))}).fail(function(i){OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(t?e:a,"立即购买"),d.removeClass("hidden"),d.region({pid:-1,cid:-1,did:-1,tid:-1})}).always(function(t,e){$(".buying-actions").next(".alert-danger").remove(),"timeout"===e&&n.abort()})},S=($(".button-notice"),$("#button-notice-submit")),I=$("#dialog-notice"),q=$("#dialog-notice-success"),j=$("#dialog-reserve-success"),T=$("#dialog-notice-success .count-down"),L=$('#dialog-notice input[name="mobile"]'),E=$("#dialog-notice .alert-danger"),D=function(){$("body").on("click",".button-notice",function(){I.removeClass("hidden"),L.val(""),E.html(""),S.html("提交")});var t=!1,e=function(){var e=OPPO.conf.BASE_URL+"/products/notice/"+Yo.config.product_id,i=$.trim(L.val());return""===i||null===i?(E.html("请输入手机号码。"),!1):OPPO.utils.isMobile(i)?(t=!0,S.html("提交中..."),void $.ajax({url:e,type:"post",dataType:"json",data:{mobile:i}}).done(function(t){if(!ajaxIsLogin(t))return!1;var e=parseInt(t.status,10);e>0?(L.val(""),E.html(""),I.addClass("hidden"),388!=Yo.config.product_id&&389!=Yo.config.product_id&&392!=Yo.config.product_id&&393!=Yo.config.product_id&&394!=Yo.config.product_id&&253!=Yo.config.product_id?q.removeClass("hidden"):j.removeClass("hidden"),T.html(3),a(3)):E.html(t.message)}).fail(function(t){E.html(t.message)}).always(function(e){t=!1,S.html("提交")})):(E.html("手机号码格式不正确。"),!1)};S.on("click",function(){t||e()});var i,a=function(t){return clearTimeout(i),t<=0?(T.html(3),q.addClass("hidden"),!1):(T.html(t),t--,void(i=setTimeout(function(){a(t)},1e3)))}},A=function(){var t=$("#good-gifts");t.find(".gift-item").each(function(){var t=$(this),e=t.find(".y-img"),i=t.find(".swatches"),a=t.find("input");i.on("click",".swatch a",function(t){var n=$(this).parent(),r=n.attr("data-gift-id"),s=n.attr("data-thumbnail");if(i.find("li").removeClass("selected"),!n.hasClass("selected")){n.addClass("selected"),a.val(r);var o=$("<img />").attr("src",s);e.html(o)}t.preventDefault()})})},U=$(".pro-packages .tab-selected"),B=function(){U.on("click",function(){
$(this).hasClass("active")?($(this).removeClass("active"),a.removeClass("hidden"),$("#button-buy-div").removeClass("hidden")):(U.removeClass("active"),$(this).addClass("active"),$("#button-buy-div").addClass("hidden"),a.removeClass("hidden"))})},F=function(){this.$suits=$("#suits"),this.initialize()},R=F.prototype;R.initialize=function(){this.onCheckbox()},R.onCheckbox=function(){var t=this,e=t.$suits,i=e.find(".s-goods");$("#collect-prices"),$("#extent-price");i.each(function(){var t=$(this),e=t.attr("data-id"),i=t.attr("data-origin"),a=t.attr("data-price"),n=t.find("label.checkbox"),r=n.find('input[type="checkbox"]'),s=n.find(".icon-checked"),o=n.find(".icon-unchecked");r.on("change",function(){r.is(":checked")?(r.attr("data-origin",i).attr("data-price",a),r.val(e),s.css("display","block"),o.hide()):(r.removeAttr("data-origin").removeAttr("data-price"),r.val(""),o.css("display","block"),s.hide()),$("#amount-textbox").val(1),F.calculatePrice()})})},F.calculateMain=function(){var t=$("#collect-prices"),e=parseInt(t.attr("data-promoted")||0,10),i=parseInt(t.attr("data-price")||0,10),a=$("#product-services"),n=a.find(".pro-service-tab.active"),r=$("#package-main-price");n.each(function(){var t=$(this),a=parseInt(t.attr("data-origin")||0,10),n=parseInt(t.attr("data-price")||0,10);e+=n,i+=a}),e<i?r.html("<em>"+e.toFixed(2)+"</em><del>"+i.toFixed(2)+"</del>"):r.html("<em>"+i.toFixed(2)+"</em>")},F.calculatePrice=function(){var t=$("#suits"),e=$("#collect-prices"),i=$("#extent-price"),a=t.find("input:checked"),n=$("#product-services"),r=n.find(".pro-service-tab.active"),s=parseInt(e.attr("data-promoted")||0,10),o=parseInt(e.attr("data-price")||0,10);if(a.each(function(){var t=$(this),e=parseInt(t.attr("data-origin")||0,10),i=parseInt(t.attr("data-price")||0,10);s+=i,o+=e}),r.each(function(){var t=$(this),e=parseInt(t.attr("data-origin")||0,10),i=parseInt(t.attr("data-price")||0,10);s+=i,o+=e}),a.length>0||r.length>0?s<o?e.html("<em>&yen;"+s.toFixed(2)+"</em><del>&yen;"+o.toFixed(2)+"</del>"):e.html("<em>&yen;"+s.toFixed(2)+"</em>"):(s=parseInt(e.attr("data-promoted")||0,10),o=parseInt(e.attr("data-price")||0,10),s<o?e.html("<em>&yen;"+s.toFixed(2)+"</em><del>&yen;"+o.toFixed(2)+"</del>"):e.html("<em>&yen;"+o.toFixed(2)+"</em>")),o-s>0){var c=o-s;i.html("已优惠 &yen;"+c.toFixed(2))}else i.html("")};var M={data:{min:15,max:25},queued:!0,threshold:15e3,timer:null,refresh_timer:null,rushed:!1,timestamp:null,elems:{container:$("#rush-button-container"),tips:$("#rush-tips")},templates:{countdown:'<button class="button-disabled" id="rush-countdown" disabled></button>',buy:'<button class="button button-primary" id="rush-buy">立即抢购</button>',pre:$(".button-reserve"),carry:'<button class="button-disabled" disabled>还有机会</button>',end:'<button class="button-disabled" disabled>已售罄</button>',normal:'<div class="gi one-half"><button class="button-light" id="button-buy">加入购物车</button></div><div class="gi one-half"><button class="button button-primary" id="go-buy">立即购买</button></div>'},initialize:function(){var t=this;0!=t.elems.container.length&&(t.setConfig(),t.queued?(t.getThreshold(),t.getData(),t.emit()):t.timestamp>t.data.countdownStart&&t.timestamp<t.data.countdownEnd?(t.elems.container.html(t.templates.countdown),t.tick()):t.timestamp>t.data.countdownEnd&&"undefined"!=typeof Yo.config.snapped&&t.elems.container.parent().html(t.templates.normal))},setConfig:function(){this.data.countdownStart=+new Date(Yo.config.countdown_start),this.data.countdownEnd=+new Date(Yo.config.countdown_end),this.data.pid=Yo.config.product_id,this.timestamp=1e3*parseInt(Yo.config.timestamp,10)||0},emit:function(){var t=this;$("#rush-button-container").off("click").on("click","#rush-buy",function(e){t.getData(function(t){t?OPPO.submit.isSubmit||vm.addToCart(!1,0,Yo.config.product_id,!0):new Modal("有人还未付款，若15分钟后仍未付款，您将有购买机会！")}),e.preventDefault()})},getThreshold:function(){var t=this,e=t.data.min,i=t.data.max,a=e+Math.floor((i-e)*Math.random());t.threshold=1e3*a},polling:function(){var t=this,e=function(){t.timer=setTimeout(function(){e(),t.getData()},t.threshold)};e()},getData:function(t){var e,i=this,a=i.data.pid,n=i.elems.container,r=i.elems.tips;$.ajax({url:"/getstock.php",data:{goods_id:a,v:+new Date},dataType:"json",timeout:3e3}).then(function(t){e=t}).fail(function(){n.html(i.templates.pre),r.html(""),clearTimeout(i.timer)}).done(function(){i.setStatus(e,t)})},setStatus:function(t,e){var i=this,a=i.elems.container,n=i.elems.tips,r=i.templates,t=t,s=t.data,o=!i.queued||s.stock,c=!!i.queued&&s.end,l=parseInt(t.status,10)||0,d=i.data.timestamp=1e3*parseInt(s.timestamp,10);if(l<=0)return void clearTimeout(i.timer);if(l>0){var u=!1;d>i.data.countdownStart&&d<i.data.countdownEnd?(a.html(r.countdown),i.tick(),n.html(""),clearTimeout(i.timer)):d>i.data.countdownEnd&&c?(a.html(r.end),i.stop(),clearTimeout(i.timer)):d>i.data.countdownEnd&&o?(a.html(r.buy),n.html(""),u=!0):d>i.data.countdownEnd&&!c&&!o?(a.html(r.carry),n.html(i.threshold/1e3+"秒后自动刷新"),clearTimeout(i.refresh_timer),i.refresh(),i.rushed||(i.polling(),i.rushed=!0)):(a.html(i.templates.pre),n.html(""),clearTimeout(i.timer)),e&&e.call(null,u)}},tick:function(){var t=this,e=t.templates,i=t.elems.container,a=$("#rush-countdown"),n=(t.queued?t.data.timestamp:t.timestamp)/1e3,r=t.data.countdownEnd,s=null,o=function(){s=setTimeout(function(){o();var c=t.countdown(n,r);return c[1]?(t.queued?i.html(e.buy):i.parent().html(t.templates.normal),void clearTimeout(s)):(n++,void a.html("还有"+c[0]))},1e3)};o()},formatNumber:function(t){return t<10?"0"+t:t},countdown:function(t,e){var i=this,a=e/1e3,n=a-t,r=parseInt(n%60),s=parseInt(n/60%60),o=parseInt(n/3600%24),c=parseInt(n/3600/24),l=[r.toString(),s.toString(),o.toString()];return n<=0?["00小时00分00秒",!0]:c>0?[c+"<span>天</span>"+i.formatNumber(l[2])+"<span>时</span>"+i.formatNumber(l[1])+"<span>分</span>"+i.formatNumber(l[0])+"<span>秒</span>",!1]:[i.formatNumber(l[2])+"<span>时</span>"+i.formatNumber(l[1])+"<span>分</span>"+i.formatNumber(l[0])+"<span>秒</span>",!1]},refresh:function(){var t=this,e=t.elems.tips,i=t.threshold/1e3,a=function(){t.refresh_timer=setTimeout(function(){return i--,e.html(i+"秒后自动刷新"),1===i?(i=0,void clearTimeout(t.refresh_timer)):void a()},1e3)};a()},stop:function(){var t=this,e=t.elems.tips;clearTimeout(t.refresh_timer),e.html("")}},z={imei:"",objs:{check:$(".supports-phonecheck"),result:$(".supports-check-result"),inputs:{type:$('input[name="type"]'),imei:$('input[name="imei"]'),captcha:$('input[name="captcha"]')},btns:{query:$("#rQueryBtn")},tips:{query:$(".error-query")}},init:function(){var t=z;t.objs.btns.query.off().on("click",function(){OPPO.submit.isSubmit||t.query()})},query:function(){var t=z.objs,e=$.trim(t.inputs.type.val()),i=$.trim(t.inputs.imei.val()),a=$.trim(t.inputs.captcha.val());if(t.tips.query.html(""),!i)return void t.tips.query.html("请输入您的手机IMEI号");if(!OPPO.utils.isImei(i))return void t.tips.query.html("IMEI号格式不正确");if(!a)return void t.tips.query.html("请输入验证码");if(!OPPO.utils.checkCaptcha(a))return void t.tips.query.html("验证码格式不正确");OPPO.submit.isSubmit=!0,OPPO.submit.change(t.btns.query,"提交中"),z.imei=i;var n=$.ajax({url:"/guarantee/rebuy/query",type:"post",data:{type:e,imei:i,captcha:a},dataType:"json",timeout:2e4}).done(function(e){parseInt(e.status)>0?(t.check.hide(),t.result.html(e.data.data),$(".rebuy-tab-time").on("click",Y),$("#rCreateBtn").off().on("click",function(){OPPO.submit.isSubmit||N()}),$("#service-igree").on("click",function(){$("#modal-service").modal()}),$("#rModifyBtn").off().on("click",function(){OPPO.submit.isSubmit||Z()}),$("#datePicker").datepicker({dateFormat:"yy-mm-dd",maxDate:new Date,changeMonth:!0,changeYear:!0,monthNamesShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"],dayNamesMin:["日","一","二","三","四","五","六"]})):t.tips.query.html(e.message)}).fail(function(e){t.tips.query.html("系统异常，请重试")}).always(function(e,i){"timeout"===i&&n.abort(),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(t.btns.query,"立即查询"),OPPO.utils.updateCaptcha()})}},Y=function(){var t=$(".rebuy-tab-time");if(t.length>1){if($(this).hasClass("active"))return;t.removeClass("active"),$(this).addClass("active");var e=parseInt($(this).data("price-current")),i=parseInt($(this).data("price-origin"));e<i?$(".rebuy-price").html("¥"+e+"<span>¥"+i+"</span>"):$(".rebuy-price").html("¥"+e)}},N=function(){var t={inputs:{username:$('input[name="username"]'),mobile:$('input[name="mobile"]'),type:$('input[name="type"]')},btns:{create:$("#rCreateBtn")},tips:{create:$(".error-create")},tabs:$(".rebuy-tab-time")},e=$.trim(t.inputs.username.val()),i=$.trim(t.inputs.mobile.val()),a=$.trim(t.inputs.type.val()),n=0,r=0;if(t.tips.create.html(""),t.tabs.each(function(){$(this).hasClass("active")&&(n=$(this).data("price-current"),r=$(this).data("ttl-type"))}),!e)return void t.tips.create.html("请输入机主真实姓名");if(OPPO.utils.checkSpec(e))return void t.tips.create.html("姓名不能包含[【】&*<>]");if(OPPO.utils.strlen(e)>OPPO.utils.namelen)return void t.tips.create.html("姓名不能超过"+OPPO.utils.namelen+"个字符");if(!i)return void t.tips.create.html("请输入机主手机号码");if(!OPPO.utils.isMobile(i))return void t.tips.create.html("手机号码格式不正确");OPPO.submit.isSubmit=!0,OPPO.submit.change(t.btns.create,"提交中");var s=$.ajax({url:"/guarantee/rebuy/create",type:"post",data:{imei:z.imei,username:e,mobile:i,price:n,type:a,ttl:r},dataType:"json",timeout:2e4}).done(function(e){parseInt(e.status)>0?location.href=e.data:t.tips.create.html(e.message)}).fail(function(e){t.tips.create.html("系统异常，请重试")}).always(function(e,i){"timeout"===i&&s.abort(),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(t.btns.create,"立即购买")})},Z=function(){var t={inputs:{time:$("#datePicker")},btns:{modify:$("#rModifyBtn")},tips:{modify:$(".error-modify")}},e=$.trim(t.inputs.time.val());if(!OPPO.utils.checkDate(e))return void t.tips.modify.html("日期格式不正确");OPPO.submit.isSubmit=!0,OPPO.submit.change(t.btns.modify,"提交中"),t.tips.modify.html("");var i=$.ajax({url:"/guarantee/rebuy/modify",type:"post",data:{imei:z.imei,time_buying:e},dataType:"json",timeout:2e4}).done(function(e){parseInt(e.status)>0?(t.btns.modify.hide(),t.tips.modify.html("修改成功")):t.tips.modify.html(e.message)}).fail(function(e){t.tips.modify.html("系统异常，请重试")}).always(function(e,a){"timeout"===a&&i.abort(),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(t.btns.modify,"保存")})};return{serviceIMEI:function(){z.init()},index:function(){function t(){if($(".navigation-filters").length&&$(window).width()<750){var t=$(".navigation-filters .is-active a").text();$(".navigation-filters .filter-name .current").text(t),$(".navigation-filters .filter-name").on("click",function(){$(this).parent(".navigation-filters").toggleClass("is-open")}),$(".navigation-filters li a").on("click",function(t){t.preventDefault();var e=$(this).parents(".navigation-filters"),i=$(this).parent("li"),a=$(this).text();i.addClass("is-active").siblings("li").removeClass("is-active"),e.find(".filter-name .current").text(a),e.removeClass("is-open"),window.location.href=$(this).attr("href")})}else $(".navigation-filters .filter-name").off(),$(".navigation-filters li a").off()}function e(t){if(t&&t.length){for(var e="",i=t.length>4?4:t.length,a=0;a<i;a++){var n=t[a];href="/products/"+n.id+".html",e+='<div class="box" style="height: 422px;">',e+='<a target="_blank" href="'+href+'">',e+='<div class="box-photo"><img alt="" title="" src="'+n.rpath+'"></div></a>',e+='<h2 class="box-heading"><a target="_blank" href="'+n.href+'" title="">',e+='</a><a target="_blank" href="'+href+'" title="'+n.name+'">'+n.name+"</a></h2>",e+='<div class="box-details">',0==n.is_price_hidden&&(n.promoted?(e+='<p class="box-price box-price-offer">',e+='<span class="normal">￥'+n.price+"</span>",e+='<strong class="reduced">￥'+n.promoted_price+"</strong></p>"):(e+='<p class="box-price">',e+='<span class="normal">&nbsp;</span>',e+="<strong>"+n.price+"</strong></p>")),e+="</div>";var r="";switch(n.new_product){case 1:r="ribbon-new";break;case 2:r="ribbon-promotion";break;case 3:r="ribbon-cheap";break;default:r=""}e+='<i class="ribbon '+r+'"></i>',e+="</div>"}$("#goods_view_history_list").html(e),$("#goods_view_history").show()}}function i(){var t=OPPO.utils.getCookie("view_history");t&&$.ajax({url:"/products/0/visit_history",type:"GET"}).then(function(t){data=t}).done(function(){var t=data.status;"1"==t&&e(data.data)}).fail(function(){})}t(),i(),$(window).resize(function(){t()})},show:function(){return new F,M.initialize(),r(),D(),A(),B(),{attrKeys:[],quicklyBuy:function(){w()},addToCart:function(t,e,a,n,r){var s=$(".service-repair"),o=$(".service-screen"),c=$(".service-accident"),l=0,d=0,u=0,m=$("#amount-textbox").val(),n=n||!1,r=r||!1;if(s&&s.each(function(){$(this).hasClass("active")&&(l=$(this).data("ttl"))}),o&&o.each(function(){$(this).hasClass("active")&&(d=$(this).data("ttl"))}),c&&c.each(function(){$(this).hasClass("active")&&(u=$(this).data("ttl"))}),!/^\d+$/.test(m))return void alert("请填写购买数量!");var p={id:a,quantity:m,type:e,services:{repair:l,screen:d,accident:u}};if(r){var f=$("#suits").find("input:checked");f.each(function(){var t=$(this),e=parseInt(t.val()||0,10),i=parseFloat(t.attr("data-price")||0,10);e>0&&(p["packages["+e+"]"]=i)})}n&&(p.quickbuy=1),$('[name="gift[]"]').length>0&&$('[name="gift[]"]').each(function(t){var e=$(this);p["gifts["+t+"]"]=e.val()}),i(p,t,n,r)}}}}},OPPO.controller.PromotionsController=function(){var t=function(t,e){var i=OPPO.conf.BASE_URL+"/cart/insert";$.post(i,t,function(){var t=OPPO.conf.BASE_URL+(e?"/trade":"/cart");window.location.href=t})};return{show:function(){return $("#promotion-add-cart-form span.radio").each(function(t,e){$(e).off("click")}),{addToCart:function(e,i,a){var n={id:a,quantity:1,type:i};t(n,e)}}}}},OPPO.controller.RegionController=function(){return{pcrselect:function(t){var e={obj:this,pid:0,cid:0,rid:0};if($.extend(e,t),"undefined"==typeof arrCity||arrCity.length<=0)return!1;var i=$(e.obj),a=i.find("select[name=province_id]"),n=i.find("select[name=city_id]"),r=i.find("select[name=district_id]"),s=parseInt(e.pid),o=parseInt(e.cid),c=parseInt(e.rid);if(a.length<=0||n.length<=0||r.length<=0)return!1;var l=function(t){$(t).parent().find(".select_label").html("<span>"+$(t).find("option:selected").text()+"</span>")},d=function(t){r.html(""),$.each(t,function(t,e){var i=parseInt(e.id,10),a=e.name;0===t&&0===c&&(c=i),i!==c?r.append('<option value="'+i+'">'+a+"</option>"):r.append('<option value="'+i+'" selected>'+a+"</option>"),l(r)})},u=function(t){n.html(""),$.each(t,function(t,e){var i=parseInt(e.id,10),a=e.name,r=e.sub;0===t&&0===o&&(o=i),i!==o?n.append('<option value="'+i+'">'+a+"</option>"):(n.append('<option value="'+i+'" selected>'+a+"</option>"),r.length>0&&o!==-1&&d(r)),l(n)})},m=function(){a.html(""),$.each(arrCity,function(t,e){var i=parseInt(e.id,10),n=e.name,r=e.sub;i!==s?a.append('<option value="'+i+'">'+n+"</option>"):(a.append('<option value="'+i+'" selected>'+n+"</option>"),r.length>0&&u(r)),l(a)})};m(),a.on("change",function(){s=parseInt($(this).val()),o=0,c!==-1&&(c=0),m()}),n.on("change",function(){o=parseInt($(this).val()),c!==-1&&(c=0),m()})}}},OPPO.controller.TradesController=function(){var t,e=($("select[name=province_id]"),$("select[name=city_id]"),$("select[name=district_id]"),$(".error_msg_note")),i=$(".remove-address"),a=$(".address-update"),n=$(".address-cancel"),r=$(".address-store"),s=$(".address-more"),o=$(".address-new-cancel"),c=$("#address_new"),l=$(".address-form-new"),d=$("input[name=voucher]"),u=$(".coupon-code-use"),m=$(".coupon-code-clear"),p=$("input[name=coupon-code]"),f=($(".coupon-more-btn"),$(".coupon-code .alert-danger")),h=$("#update-invoice-btn"),v=$("#save-invoice-title"),b=$("#invoice-new"),g=$("#invoice-title"),P=$("input[name=invoicetitle]"),O=$("input[name=invoice_title]"),_=$("input[name=goods_fee]"),y=$("input[name=shipping_fee]"),k=$("input[name=shipping_id]"),x=$("input[name=discount_fee]"),C=$("input[name=payment_fee]"),w=$("input[name=payment_id]"),S=$("input[name=amount_fee]"),I=$(".cart-button"),q=($(".payment_method_jsd"),function(t){return 11===t.length&&!isNaN(t)&&"1"===t.substring(0,1)}),j=function(t,e){$(t+" .form-actions").next(".alert-danger").remove(),$(t+" .form-actions").after('<div class="field alert-danger">'+e+"</div>")};return{index:function(){i.click(function(){if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0;var t=$(this).attr("data-id"),i=OPPO.conf.BASE_URL+"/addresses/"+t;$.ajax({type:"delete",url:i}).success(function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);i>0?window.location.reload():(e.text(t.message),OPPO.submit.isSubmit=!1)}).error(function(t){e.text("系统异常。"),OPPO.submit.isSubmit=!1})}),a.click(function(){var t=$(this).attr("data-id"),e="#address-edit-"+t,i=$(e+" input[name=receiver]"),n=$(e+" input[name=mobile]"),r=$(e+" input[name=email]"),s=$(e+" input[name=address-detail]"),o=$(e+" select[name=province_id]"),c=$(e+" select[name=city_id]"),l=$(e+" select[name=district_id]"),d=$(e+" select[name=town_id]"),u=$(e+" input[name=postcode]"),m=$.trim(i.val()),p=$.trim(n.val()),f=$.trim(r.val()),h=$.trim(o.val()),v=$.trim(c.val()),b=$.trim(l.val()),g=$.trim(d.val()),P=$.trim(s.val()),O=$.trim(u.val());if(!m)return j(e,"请输入收货人姓名。"),!1;if(OPPO.utils.strlen(m)>OPPO.utils.namelen)return j(e,"收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(OPPO.utils.checkSpec(m))return j(e,"收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(!p)return j(e,"请输入手机号码。"),!1;if(!OPPO.utils.isMobile(p))return j(e,"手机号码格式不正确。"),!1;if(!h||parseInt(h)===-1)return j(e,"请选择您的收货地址。"),!1;if(!P)return j(e,"请输入详细地址。"),!1;if(OPPO.utils.checkSpec(P))return j(e,"详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(P)>OPPO.utils.addrlen)return j(e,"详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(a,"提交中"),P=OPPO.utils.filtertxt(P,o.find("option:selected").text()),P=OPPO.utils.filtertxt(P,c.find("option:selected").text()),P=OPPO.utils.filtertxt(P,l.find("option:selected").text()),P=OPPO.utils.filtertxt(P,d.find("option:selected").text());var _=OPPO.conf.BASE_URL+"/addresses/"+t,y={receiver:m,mobile:p,email:f?f:"",address:P,province_id:h,city_id:v,district_id:b,town_id:g,postcode:O};$.ajax({type:"PUT",url:_,data:y,success:function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);i>0?window.location.reload():(j(e,t.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"保存"))},error:function(t){j(e,"系统异常。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"保存")}})}),n.on("click",function(t){t.preventDefault();var e=$(this).attr("data-id"),i=$("[data-address-id="+e+"]");i.find(".form-actions").next(".alert-danger").remove(),i.hide();var a=i.next();a.show()}),o.on("click",function(t){t.preventDefault();var e="#address-create",i=$(e+" input[name=receiver]"),a=$(e+" input[name=mobile]"),n=$(e+" input[name=email]"),r=$(e+" input[name=address-detail]"),s=$(e+" input[name=postcode]");i.val(""),a.val(""),n.val(""),r.val(""),s.val(""),$(e+" .form-actions").next(".alert-danger").remove(),$("#address-create").region({pid:-1,cid:-1,did:-1,tid:-1}),$(e).parent().hide()}),c.click(function(){$("#address-create .form-actions").next(".alert-danger").remove(),l.toggle(),$("#address-create").region({pid:-1,cid:-1,did:-1,tid:-1})}),r.click(function(){var t="#address-create",e=$(t+" input[name=receiver]"),i=$(t+" input[name=mobile]"),a=$(t+" input[name=email]"),n=$(t+" input[name=address-detail]"),s=$(t+" select[name=province_id]"),o=$(t+" select[name=city_id]"),c=$(t+" select[name=district_id]"),l=$(t+" select[name=town_id]"),d=$(t+" input[name=postcode]"),u=$(t+" input[name=validation_code]"),m=$.trim(e.val()),p=$.trim(i.val()),f=$.trim(a.val()),h=$.trim(s.val()),v=$.trim(o.val()),b=$.trim(c.val()),g=$.trim(l.val()),P=$.trim(n.val()),O=$.trim(d.val()),_=$.trim(u.val());if(!m)return j(t,"请输入收货人姓名。"),!1;if(OPPO.utils.strlen(m)>OPPO.utils.namelen)return j(t,"收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(OPPO.utils.checkSpec(m))return j(t,"收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(!p)return j(t,"请输入手机号码。"),!1;if(!OPPO.utils.isMobile(p))return j(t,"手机号码格式不正确。"),!1;if(!h||parseInt(h)===-1)return j(t,"请选择您的收货地址。"),!1;if(!P)return j(t,"请输入详细地址。"),!1;if(OPPO.utils.checkSpec(P))return j(t,"详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(P)>OPPO.utils.addrlen)return j(t,"详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;P=OPPO.utils.filtertxt(P,s.find("option:selected").text()),P=OPPO.utils.filtertxt(P,o.find("option:selected").text()),P=OPPO.utils.filtertxt(P,c.find("option:selected").text()),P=OPPO.utils.filtertxt(P,l.find("option:selected").text());var y={receiver:m,mobile:p,email:f?f:"",address:P,province_id:h,city_id:v,district_id:b,town_id:g,postcode:O},k=function(){if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(r,"提交中");var e=OPPO.conf.BASE_URL+"/addresses";$.post(e,y).success(function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);i>0?window.location.reload():(j(t,e.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(r,"保存"))}).error(function(e){j(t,"系统异常。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(r,"保存")})};if(_){y.activation_code=_;var x=OPPO.conf.BASE_URL+"/auth/direct_register";$.post(x,{user:p,code:_}).success(function(){k()}).error(function(e){j(t,"系统异常。")})}else k()}),s.on("click",function(){s.hide(),$(".address-form-item").show()});var T,L=function(t){var e=parseInt(t),i="手机专用";switch(e){case 1:i="手机专用";break;case 2:i="配件专用";break;case 3:i="手机/配件通用"}return i},E=function(t,e){$("#discount_fee_price").text("- ￥"+parseFloat(t).toFixed(2)),x.val(parseFloat(t).toFixed(2)),Q(),d.val(e)},D=function(t){if(!(!$(".cart-alipay-hb").length>0)){if(4==$("input[name=payment_method_radio]:checked").val()||11==$("input[name=payment_method_radio]:checked").val())return void $(".cart-alipay-hb").hide();t<600?$(".cart-alipay-hb").hide():$(".cart-alipay-hb").show();var e=$(".cart-alipay-hb").data("checkfree"),i=1;0==e&&(i=1.08);var a=parseFloat(t*i/12).toFixed(2);$(".total-hb").html("￥"+a+"x12期")}},A=function(t){var e=OPPO.conf.BASE_URL+"/coupons/available";T=$.get(e,function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);if(i>0){if(!e.data)return;t?B(e.data):U(e.data)}})},U=function(t){if(t.available&&t.available.length>0){for(var e="",i=0;i<t.available.length;i++){var a=t.available[i].coupon_code;e+=i>4?'<div class="g g-hide">':'<div class="g">',e+=' <div class="gi one-third desk-one-quarter">',e+='  <div class="radio-item radio-item-coupon-list">',e+=0===i?'    <input id="coupon-list-'+i+'" name="coupon-list" type="radio" value="'+a.discount_fee+'" data-code="'+a.c_code+'" checked>':'    <input id="coupon-list-'+i+'" name="coupon-list" type="radio" value="'+a.discount_fee+'" data-code="'+a.c_code+'">',e+='    <label for="coupon-list-'+i+'">'+a.discount_fee+"元</label>",e+="  </div>",e+=" </div>",e+=' <div class="gi one-third desk-one-quarter break-all">'+L(a.c_type)+"（满"+a.limit_fee+"可用）</div>",e+=' <div class="gi one-third desk-two-quarters break-all">'+a.c_starttime+" - "+a.c_endtime+"</div>",e+="</div>",i>4&&i===t.available.length-1&&(e+='<div class="coupon-more">',e+='<a class="coupon-more-btn">展开查看更多可用优惠券<span class="icon icon-arrow-light-down"></span></a>',e+="</div>")}$(".coupon-tabs-content .js-tab").eq(0).html(e);$("input[name=coupon-list]").custom_form({responsive_select:!0});if($("input[name=coupon-list]:checked")){var n=$("input[name=coupon-list]:checked");E(n.val(),n.data("code"))}$("input[name=coupon-list]").change(function(){E($(this).val(),$(this).data("code"))})}else $(".coupon-tabs-content .js-tab").eq(0).html('<div class="coupon-none">您暂时还没有可用优惠券哦。</div>');if(t.unavailable&&t.unavailable.length>0){for(var e="",i=0;i<t.unavailable.length;i++){var a=t.unavailable[i].coupon_code;e+=i>4?'<div class="g g-hide">':'<div class="g">',e+=' <div class="gi one-third desk-one-quarter"><span class="space-ml-50">'+a.discount_fee+"元</span></div>",e+=' <div class="gi one-third desk-one-quarter break-all">'+L(a.c_type)+"（满"+a.limit_fee+"可用）</div>",e+=' <div class="gi one-third desk-two-quarters break-all">'+a.c_starttime+" - "+a.c_endtime+"</div>",e+="</div>",i>4&&i===t.unavailable.length-1&&(e+='<div class="coupon-more">',e+='<a class="coupon-more-btn">展开查看更多可用优惠券<span class="icon icon-arrow-light-down"></span></a>',e+="</div>")}$(".coupon-tabs-content .js-tab").eq(1).html(e)}else $(".coupon-tabs-content .js-tab").eq(1).html('<div class="coupon-none">您暂时还没有不可用优惠券哦。</div>');$(".coupon-more-btn").on("click",function(){var t=$(this).parent().siblings(".g");$(this).hasClass("active")?t.each(function(t,e){t<5?$(e).show(200):$(e).hide(200)}):t.show(200),$(this).toggleClass("active")})},B=function(t){var e="";if(void 0!=t.length&&0===t.length)e+="<div>您暂时还没有可用优惠券哦。</div>";else{if(e+='<div class="content-coupon-list">',t.available&&t.available.length>0)for(var i=0;i<t.available.length;i++){var a=t.available[i].coupon_code;e+='<div class="g">',e+=' <div class="gi one-third">',e+='   <div class="radio-item radio-item-coupon-list">',e+=0===i?'     <input id="coupon-list-'+i+'" name="coupon-list-m" type="radio" value="'+a.discount_fee+'" data-code="'+a.c_code+'" checked>':'     <input id="coupon-list-'+i+'" name="coupon-list-m" type="radio" value="'+a.discount_fee+'" data-code="'+a.c_code+'">',e+='     <label for="coupon-list-'+i+'">'+a.discount_fee+"元</label>",e+="   </div>",e+=" </div>",e+=' <div class="gi two-thirds">',e+='   <p class="break-all"><strong>'+L(a.c_type)+"（满"+a.limit_fee+"可用）</strong></p>",e+='   <p class="break-all">'+a.c_starttime+" - "+a.c_endtime+"</p>",e+=" </div>",e+="</div>"}if(t.unavailable&&t.unavailable.length>0)for(var i=0;i<t.unavailable.length;i++){var a=t.unavailable[i].coupon_code;e+='<div class="g unavailable">',e+=' <div class="gi one-third">',e+='   <span class="space-ml-30">'+a.discount_fee+"元</span>",e+=" </div>",e+=' <div class="gi two-thirds">',e+='   <p class="break-all">'+L(a.c_type)+"（满"+a.limit_fee+"可用）</p>",e+='   <p class="break-all">'+a.c_starttime+" - "+a.c_endtime+"</p>",e+=" </div>",e+="</div>"}e+="</div>",t.available&&t.available.length>0&&(e+='<div class="g"><div class="alert-danger"></div><a class="button conform-btn">确认</a></div>')}$("#dialog-coupon-voucher .dialog-content").html(e);var n=.6*$(window).height(),r=$("#dialog-coupon-voucher .content-coupon-list");r.height()>n&&r.css({"max-height":n,"padding-right":"10px","overflow-y":"scroll"});$("input[name=coupon-list-m]").custom_form({responsive_select:!0});if($("input[name=coupon-list-m]:checked")){$("input[name=coupon-list-m]:checked")}$("#dialog-coupon-voucher .conform-btn").on("click",function(t){t.preventDefault();var e=$("input[name=coupon-list-m]:checked");return e.length?($("#dialog-coupon-voucher .alert-danger").html(""),$(".coupon-choice-1").html('已使用1张，优惠<i class="color-red">￥'+e.val()+"元</i>"),$(".coupon-choice-2").html(""),E(e.val(),e.data("code")),void $("#dialog-coupon-voucher").addClass("hidden")):($("#dialog-coupon-voucher .alert-danger").html("请选择可使用优惠券"),!1)})},F=$(".coupon-mykq-use"),R=$(".coupon-mykq-clear"),M=$("input[name=coupon-mykq]"),z=$(".coupon-mykq .alert-danger");$("input[name=coupon-type]").change(function(){E("0.00",""),T&&T.abort(),"1"===$(this).val()?($(".coupon-code").hide(),$(".coupon-mykq").hide(),$(".coupon-tabs").show(),$(".js-tabs-nav a").eq(0).trigger("click"),$(".coupon-tabs-content .js-tab").eq(0).html('<div class="coupon-none">玩命加载中。。。</div>'),A(!1)):"2"===$(this).val()?($(".coupon-tabs").hide(),$(".coupon-mykq").hide(),$(".coupon-code").show(),$(".coupon-code-result").find("span").text(""),$(".coupon-code-result").hide(),$(".coupon-code-field").show(),f.html(""),p.val("")):($(".coupon-tabs").hide(),$(".coupon-code").hide(),$(".coupon-mykq").show(),$(".coupon-mykq-result").find("span").text(""),$(".coupon-mykq-result").hide(),$(".coupon-mykq-field").show(),z.html(""),M.val(""))}),F.click(function(){var t=$.trim(M.val());return z.html(""),t&&""!==t?"美因苛求2016"!==t?(z.html("口令不正确。"),!1):(E("0.00",t),$(".coupon-mykq-field").hide(),$(".coupon-mykq-result").html("前4000名支付用户可额外获得一个半年延保").show(),z.html(""),void M.val("")):(z.html("请输入口令。"),!1)}),R.on("click",function(){M.val(""),$(".coupon-mykq .alert-danger").html("")}),u.click(function(){var t=$.trim(p.val());if(f.html(""),!t||""===t)return f.html("请输入优惠码。"),!1;if(!OPPO.utils.checkCoupon(t))return f.html("优惠码格式不正确。"),!1;var e=OPPO.conf.BASE_URL+"/coupons/usecoupons/"+t,i=$(".coupon-code-field"),a=$(".coupon-code-result"),n=$("#trade_total_fee font").html();$.get(e,{type:2,total_fee:n},function(e){if(!ajaxIsLogin(e))return!1;var n=parseInt(e.status,10);n>0?(f.html(""),p.val(""),i.hide(),a.show().find("span").text(e.data.discount),E(e.data.discount,t)):f.html(e.message)})}),m.on("click",function(){p.val(""),$(".coupon-code .alert-danger").html("")});var Y=$(".coupon-choice-voucher"),N=$(".coupon-choice-code"),Z=$("input[name=coupon-code-m]"),G=$("#dialog-coupon-code .use-btn"),J=$(".coupon-choice-mykq"),W=$("input[name=coupon-mykq-m]");J.on("click",function(t){t.preventDefault(),$("#dialog-coupon-mykq").removeClass("hidden"),W.val("")}),$("#dialog-coupon-mykq .use-btn").on("click",function(t){t.preventDefault();var e=$.trim(W.val()),i=$("#dialog-coupon-mykq .alert-danger");return i.html(""),e&&""!==e?"美因苛求2016"!==e?(i.html("口令不正确。"),!1):(E("0.00",e),$("#dialog-coupon-mykq").addClass("hidden"),void $(".coupon-choice-3").html("前4000名支付用户可额外获得一个半年延保")):(i.html("请输入口令。"),!1)}),Y.on("click",function(t){t.preventDefault(),$("#dialog-coupon-voucher").removeClass("hidden"),$("#dialog-coupon-voucher .dialog-content").html("玩命加载中。。。"),A(!0)}),N.on("click",function(t){t.preventDefault(),$("#dialog-coupon-code").removeClass("hidden"),Z.val("")}),G.on("click",function(t){t.preventDefault();var e=$.trim(Z.val()),i=$("#dialog-coupon-code .alert-danger");if(i.html(""),!e||""===e)return i.html("请输入优惠码。"),!1;if(!OPPO.utils.checkCoupon(e))return i.html("优惠码格式不正确。"),!1;var a=OPPO.conf.BASE_URL+"/coupons/usecoupons/"+e;$.get(a,{type:2},function(t){if(!ajaxIsLogin(t))return!1;var a=parseInt(t.status,10);a>0?($("#dialog-coupon-code").addClass("hidden"),$(".coupon-choice-1").html(""),$(".coupon-choice-2").html('优惠<i class="color-red">￥'+t.data.discount+"元</i>"),E(t.data.discount,e)):i.html(t.message)})}),$(".dialog-close").on("click",function(t){t.preventDefault(),Z.val(""),$("#dialog-coupon-code .alert-danger").html(""),$(this).parent().parent().parent().addClass("hidden")}),g.html($(".address_list_0 .title").html()),O.val($(".address_list_0 .title").html()),h.click(function(t){t.preventDefault(),h.hide(),b.toggle(),P.val(O.val())}),v.click(function(){var t=$.trim(P.val());t=t.replace(/[\<\>]/g,""),t&&""!==t&&(g.html(t),O.val(t)),b.hide(),h.show()});var Q=function(){var t=parseFloat(_.val())+parseFloat(y.val())+parseFloat(C.val())-parseFloat(x.val()),e=$("#amount_fee_price");e.text("￥"+parseFloat(t).toFixed(2)),S.val(""+t),D(t)},V=!1,K=function(){if($(".payment_method_online").parent().removeClass("g-hide"),is_cod_allowed){var t=$("input[name=address]:checked"),e=t.val(),i=$("input[name=goods_fee]").val(),a=OPPO.conf.BASE_URL+"/user/shunfengs/"+e,n={fee:i,user_address_id:e};V=!1,$.get(a,n).success(function(t){if(!ajaxIsLogin(t))return!1;var e=parseInt(t.status,10);if(e>0){var i=JSON.parse(t.data),a=1;i.length>1&&(11==i[0].payment_id?($(".payment_method_jsd").parent().removeClass("g-hide"),a=0):$(".payment_method_cod").parent().removeClass("g-hide"));var n=$("input[name=payment_method_radio]");n.removeAttr("checked"),n.eq(a)[0].checked=!0,n.parent().removeClass("checked_radio"),n.parent().eq(a).addClass("checked_radio"),w.val(n.eq(a).val());for(var r=parseFloat(0).toFixed(2),s=parseFloat(0).toFixed(2),o=0;o<i.length;o++){var c=i[o];$("#payment_method_radio"+c.payment_id).data("fee",c.payment_fee),$("#payment_method_radio"+c.payment_id).data("shipping_fee",c.shipping_fee),$("#payment_method_radio"+c.payment_id).data("shipping_id",c.shipping_id)}var l=0;r=parseFloat(i[l].shipping_fee).toFixed(2),k.val(i[l].shipping_id),y.val(""+r),$("#shipping_fee_price").text("+ ￥"+r),
C.val(s),$("#payment_fee_price").text("+ ￥"+s),Q(),$(".error_msg_note").next(".error_msg_ajax").remove(),V=!0}else $(".error_msg_note").next(".error_msg_ajax").remove(),$(".error_msg_note").after("<strong class='error_msg_ajax'>"+t.message+"</div>")}).error(function(t){$(".error_msg_note").text("系统异常。")})}else{var r=$("input[name=payment_method_radio]");r.eq(0).attr("checked"),r.parent().eq(0).addClass("checked_radio"),w.val(0),k.val(2),y.val(0),C.val(0),V=!0}};$("input[name=address]").length>0&&K(),$("input[name=address]").change(function(t){t.preventDefault(),$(".payment_method_cod").parent().addClass("g-hide"),$(".payment_method_jsd").parent().addClass("g-hide"),1==$(this)[0].checked&&K(),$(".fee-list-payment").hide();var e=$(this).attr("id");$("label").each(function(){$(this).attr("for")===e&&(g.html($(this).find(".title").html()),O.val($(this).find(".title").html()))})}),$("input[name=payment_method_radio]").change(function(){w.val($(this).val());var t=parseFloat($(this).data("fee")),e=parseFloat($(this).data("shipping_fee"));k.val($(this).data("shipping_id")),C.val(t),y.val(e),$("#shipping_fee_price").text("+ ￥"+e.toFixed(2)),4===parseInt($(this).val())||11==parseInt($(this).val())?($(".fee-list-payment").show(),$("#payment_fee_price").text("+ ￥"+t.toFixed(2)),$(".cart-alipay-hb").hide()):($(".fee-list-payment").hide(),$(".cart-alipay-hb").show()),Q()});var H=$("#get-validation-code"),X=60,tt=function(){0===X?(H.val("获取验证码").attr("disabled","false"),X=60):(H.attr("disabled","true").val(X+"秒后重新获取"),X--,setTimeout(function(){tt()},1e3))};return I.on("click",function(){OPPO.submit.isSubmit||vm.goToCreateOrder()}),{edit:function(t){if(OPPO.submit.isSubmit)return!1;var e=$("[data-address-id="+t+"]");e.show(),e.find(".form-actions").next(".alert-danger").remove();var i=e.next();i.hide();var a=i.find(".address-form-receiver").val(),n=i.find(".address-form-mobile").val(),r=i.find(".address-form-email").val(),s=i.find(".address-form-address").val();$("#address-edit-"+t+" input[name=receiver]").val(a),$("#address-edit-"+t+" input[name=mobile]").val(n),$("#address-edit-"+t+" input[name=address-detail]").val(s),$("#address-edit-"+t+" input[name=email]").val(r);var o=$("#address-edit-"+t+" select[name=province_id]").data("region-default"),c=$("#address-edit-"+t+" select[name=city_id]").data("region-default"),l=$("#address-edit-"+t+" select[name=district_id]").data("region-default"),d=$("#address-edit-"+t+" select[name=town_id]").data("region-default");return $("#address-edit-"+t).region({pid:parseInt(o),cid:parseInt(c),did:parseInt(l),tid:parseInt(d)}),!1},getValidateCode:function(){var t=$.trim($("#address-create input[name=mobile]").val());if(t&&q(t)){var i=OPPO.conf.BASE_URL+"/auth/sendActivationCode";$.post(i,{phone:t}).success(function(){tt()}).error(function(t){e.text(t.responseText)})}else e.text("请输入正确的电话号码");return!1},goToCreateOrder:function(){var i=$("input[name=address]:checked").length;if(!i)return scrollToTop(500),e.text("请选择您的收货地址"),!1;if(!V)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(I,"提交中");var a=OPPO.conf.BASE_URL+"/orders/create",n=$("#order-create-form").serializeArray(),r=1e4;return navigator.userAgent.match(/(iPhone|iPod|Android|ios|iPad)/i)&&(r=2e4),t=$.ajax({url:a,type:"POST",dataType:"json",data:n,timeout:r}).done(function(t){if(!ajaxIsLogin(t))return!1;var i=parseInt(t.status,10);if(i>0){var a=OPPO.conf.BASE_URL+"/"+t.data;window.location.replace(a)}else e.text(t.message),$(window).scrollTop()>100&&$("html, body").animate({scrollTop:0}),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(I,"提交订单")}).fail(function(){e.text("系统异常，请稍后再试。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(I,"提交订单")}).always(function(e,i){"timeout"===i&&t.abort()}),!1}}}}},OPPO.controller.AddressesController=function(){var t=($("select[name=province_id]"),$("select[name=city_id]"),$("select[name=district_id]"),$(".error_msg_note")),e=$(".address-update"),i=$(".address-cancel"),a=$(".address-store"),n=$(".address-more"),r=$(".address-new-cancel"),s=$("#address_new"),o=$(".address-form-new"),c=$(".remove-address"),l=function(t,e){$(t+" .form-actions").next(".alert-danger").remove(),$(t+" .form-actions").after('<div class="field alert-danger">'+e+"</div>")};return{index:function(){return c.click(function(){if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0;var e=$(this).attr("data-id"),i=OPPO.conf.BASE_URL+"/addresses/"+e;$.ajax({type:"delete",url:i}).success(function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);i>0?window.location.reload():(t.text(e.message),OPPO.submit.isSubmit=!1)}).error(function(e){t.text("系统异常。"),OPPO.submit.isSubmit=!1})}),e.click(function(){var t=$(this).attr("data-id"),i="#address-edit-"+t,a=$(i+" input[name=receiver]"),n=$(i+" input[name=mobile]"),r=$(i+" input[name=email]"),s=$(i+" input[name=address-detail]"),o=$(i+" select[name=province_id]"),c=$(i+" select[name=city_id]"),d=$(i+" select[name=district_id]"),u=$(i+" select[name=town_id]"),m=$(i+" input[name=postcode]"),p=$.trim(a.val()),f=$.trim(n.val()),h=$.trim(r.val()),v=$.trim(o.val()),b=$.trim(c.val()),g=$.trim(d.val()),P=$.trim(u.val()),O=$.trim(s.val()),_=$.trim(m.val());if(!p)return l(i,"请输入收货人姓名。"),!1;if(OPPO.utils.strlen(p)>OPPO.utils.namelen)return l(i,"收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(OPPO.utils.checkSpec(p))return l(i,"收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(!f)return l(i,"请输入手机号码。"),!1;if(!OPPO.utils.isMobile(f))return l(i,"手机号码格式不正确。"),!1;if(!v||parseInt(v)===-1)return l(i,"请选择您的收货地址。"),!1;if(!O)return l(i,"请输入详细地址。"),!1;if(OPPO.utils.checkSpec(O))return l(i,"详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(O)>OPPO.utils.addrlen)return l(i,"详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(e,"提交中"),O=OPPO.utils.filtertxt(O,o.find("option:selected").text()),O=OPPO.utils.filtertxt(O,c.find("option:selected").text()),O=OPPO.utils.filtertxt(O,d.find("option:selected").text()),O=OPPO.utils.filtertxt(O,u.find("option:selected").text());var y=OPPO.conf.BASE_URL+"/addresses/"+t,k={receiver:p,mobile:f,email:h?h:"",address:O,province_id:v,city_id:b,district_id:g,town_id:P,postcode:_};$.ajax({type:"PUT",url:y,data:k,success:function(t){if(!ajaxIsLogin(t))return!1;var a=parseInt(t.status,10);a>0?window.location.reload():(l(i,t.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(e,"保存"))},error:function(t){l(i,"系统异常。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(e,"保存")}})}),i.on("click",function(t){t.preventDefault();var e=$(this).attr("data-id"),i=$("[data-address-id="+e+"]");i.find(".form-actions").next(".alert-danger").remove(),i.hide();var a=i.next();a.show()}),r.on("click",function(t){t.preventDefault();var e="#address-create",i=$(e+" input[name=receiver]"),a=$(e+" input[name=mobile]"),n=$(e+" input[name=email]"),r=$(e+" input[name=address-detail]"),s=$(e+" input[name=postcode]");i.val(""),a.val(""),n.val(""),r.val(""),s.val(""),$(e+" .form-actions").next(".alert-danger").remove(),$("#address-create").region({pid:-1,cid:-1,did:-1,tid:-1}),$(e).parent().hide()}),s.click(function(){$("#address-create .form-actions").next(".alert-danger").remove(),o.toggle(),$("#address-create").region({pid:-1,cid:-1,did:-1,tid:-1})}),a.click(function(){var t="#address-create",e=$(t+" input[name=receiver]"),i=$(t+" input[name=mobile]"),n=$(t+" input[name=email]"),r=$(t+" input[name=address-detail]"),s=$(t+" select[name=province_id]"),o=$(t+" select[name=city_id]"),c=$(t+" select[name=district_id]"),d=$(t+" select[name=town_id]"),u=$(t+" input[name=postcode]"),m=$.trim(e.val()),p=$.trim(i.val()),f=$.trim(n.val()),h=$.trim(s.val()),v=$.trim(o.val()),b=$.trim(c.val()),g=$.trim(d.val()),P=$.trim(r.val()),O=$.trim(u.val());if(!m)return l(t,"请输入收货人姓名。"),!1;if(OPPO.utils.strlen(m)>OPPO.utils.namelen)return l(t,"收货人姓名不能超过"+OPPO.utils.namelen+"个字符。"),!1;if(OPPO.utils.checkSpec(m))return l(t,"收货人姓名不能包含【 】 < > & * 这些特殊字符。"),!1;if(!p)return l(t,"请输入手机号码。"),!1;if(!OPPO.utils.isMobile(p))return l(t,"手机号码格式不正确。"),!1;if(!h||parseInt(h)===-1)return l(t,"请选择您的收货地址。"),!1;if(!P)return l(t,"请输入详细地址。"),!1;if(OPPO.utils.checkSpec(P))return l(t,"详细地址不能包含【 】 < > & * 这些特殊字符。"),!1;if(OPPO.utils.strlen(P)>OPPO.utils.addrlen)return l(t,"详细地址不能超过"+OPPO.utils.addrlen+"个字符。"),!1;P=OPPO.utils.filtertxt(P,s.find("option:selected").text()),P=OPPO.utils.filtertxt(P,o.find("option:selected").text()),P=OPPO.utils.filtertxt(P,c.find("option:selected").text()),P=OPPO.utils.filtertxt(P,d.find("option:selected").text());var _={receiver:m,mobile:p,email:f?f:"",address:P,province_id:h,city_id:v,district_id:b,town_id:g,postcode:O};if(OPPO.submit.isSubmit)return!1;OPPO.submit.isSubmit=!0,OPPO.submit.change(a,"提交中");var y=OPPO.conf.BASE_URL+"/addresses";$.post(y,_).success(function(e){if(!ajaxIsLogin(e))return!1;var i=parseInt(e.status,10);i>0?window.location.reload():(l(t,e.message),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"保存"))}).error(function(e){l(t,"系统异常。"),OPPO.submit.isSubmit=!1,OPPO.submit.clearChange(a,"保存")})}),n.on("click",function(){n.hide(),$(".address-form-item").show()}),{edit:function(t){if(OPPO.submit.isSubmit)return!1;var e=$("[data-address-id="+t+"]");e.show(),e.find(".form-actions").next(".alert-danger").remove();var i=e.next();i.hide();var a=i.find(".address-form-receiver").val(),n=i.find(".address-form-mobile").val(),r=i.find(".address-form-email").val(),s=i.find(".address-form-address").val();$("#address-edit-"+t+" input[name=receiver]").val(a),$("#address-edit-"+t+" input[name=mobile]").val(n),$("#address-edit-"+t+" input[name=address-detail]").val(s),$("#address-edit-"+t+" input[name=email]").val(r);var o=$("#address-edit-"+t+" select[name=province_id]").data("region-default"),c=$("#address-edit-"+t+" select[name=city_id]").data("region-default"),l=$("#address-edit-"+t+" select[name=district_id]").data("region-default"),d=$("#address-edit-"+t+" select[name=town_id]").data("region-default");return $("#address-edit-"+t).region({pid:parseInt(o),cid:parseInt(c),did:parseInt(l),tid:parseInt(d)}),!1}}}}},OPPO.utils.isEmail=function(t){return t.match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)},OPPO.utils.isMobile=function(t){return 11===t.length&&!isNaN(t)&&"1"===t.substring(0,1)},OPPO.utils.isImei=function(t){return t.match(/^[0-9]{15}$/)},OPPO.utils.checkCaptcha=function(t){return t.match(/^[A-Za-z0-9]{5}$/g)},OPPO.utils.checkSpec=function(t){return t.match(/[\【\】\&\*\<\>]/)},OPPO.utils.checkDate=function(t){return t.match(/^(\d{4})-(\d{2})-(\d{2})$/)},OPPO.utils.updateCaptcha=function(){$("#captcha").attr("src",OPPO.conf.BASE_URL+"/captcha?"+Math.random())},OPPO.utils.strlen=function(t){var e=t.replace(/[^\x00-\xff]/g,"*");return e.length},OPPO.utils.namelen=20,OPPO.utils.addrlen=30,OPPO.utils.checkCoupon=function(t){return t.match(/^[A-Za-z0-9]{8,9}$/g)},OPPO.utils.filtertxt=function(t,e){return t.replace(e,"")},OPPO.utils.getCookie=function(t){if(document.cookie.length>0){var e=document.cookie.indexOf(t+"=");if(e!=-1){e=e+t.length+1;var i=document.cookie.indexOf(";",e);return i==-1&&(i=document.cookie.length),unescape(document.cookie.substring(e,i))}}return""},OPPO.utils.setCookie=function(t,e,i){var a=new Date;a.setDate(a.getDate()+i),document.cookie=t+"="+escape(e)+(null==i?"":";expires="+a.toGMTString())},OPPO.submit={isSubmit:!1,timer:null,counter:0,change:function(t,e){switch(t.addClass("button-submitting").html(e),OPPO.submit.counter++,OPPO.submit.counter%3){case 1:t.html(e+" 。");break;case 2:t.html(e+" 。。");break;default:t.html(e+" 。。。")}clearTimeout(OPPO.submit.timer),OPPO.submit.timer=setTimeout(function(){OPPO.submit.change(t,e)},1e3)},clearChange:function(t,e){OPPO.submit.counter=1,t.removeClass("button-submitting").html(e),clearTimeout(OPPO.submit.timer)}};